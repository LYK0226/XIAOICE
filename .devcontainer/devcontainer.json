{
    "name": "XiaoIce Dev Environment",
    "image": "mcr.microsoft.com/devcontainers/python:3.12-bookworm",
    "features": {
        "ghcr.io/devcontainers/features/docker-in-docker": {}
    },
    "postStartCommand": "docker compose -f .devcontainer/docker-compose.yml up -d && grep -q '# auto-activate .venv' /home/vscode/.bashrc || printf '\n# auto-activate .venv\nif git rev-parse --show-toplevel >/dev/null 2>&1; then\n  repo_root=$(git rev-parse --show-toplevel)\n  if [ -f $repo_root/.venv/bin/activate ]; then\n    source $repo_root/.venv/bin/activate\n  fi\nelif [ -f ${PWD}/.venv/bin/activate ]; then\n  source ${PWD}/.venv/bin/activate\nfi\n' >> /home/vscode/.bashrc",
    "portsAttributes": {
        "5050": {
            "label": "pgAdmin"
        },
        "5432": {
            "label": "Postgres"
        }
    },
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.python",
                "ms-edgedevtools.vscode-edge-devtools",
                "ms-vscode-remote.remote-containers",
                "ms-azuretools.vscode-docker",
                "ms-vscode.live-server",
                "github.copilot-chat",
                "ritwickdey.liveserver",
                "pranaygp.vscode-css-peek",
                "google.gemini-cli-vscode-ide-companion",
                "googlecloudtools.cloudcode"
            ],
            "settings": {
                "python.defaultInterpreterPath": ".venv/bin/python",
                "python.terminal.activateEnvironment": true,
                "terminal.integrated.env.linux": {
                    "VIRTUAL_ENV": "${workspaceFolder}/.venv",
                    "PATH": "${workspaceFolder}/.venv/bin:${env:PATH}"
                }
            }
        }
    }
}