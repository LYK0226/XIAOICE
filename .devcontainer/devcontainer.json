{
    "name": "XiaoIce Dev Environment",
    "image": "mcr.microsoft.com/devcontainers/base:ubuntu-22.04",
    "features": {
        "ghcr.io/devcontainers/features/python:1": {
            "version": "3.12",
            "installTools": true,
            "optimize": true
        },
        "ghcr.io/devcontainers/features/node:1": {
            "version": "lts",
            "installTools": true
        },
        "ghcr.io/devcontainers/features/docker-in-docker": {}
    },
    "postStartCommand": "docker compose -f .devcontainer/docker-compose.yml up -d",
    "postCreateCommand": "sudo apt-get update -qq && sudo apt-get install -y -qq libgl1-mesa-glx libglib2.0-0 > /dev/null 2>&1",
    "portsAttributes": {
        "5000": {
            "label": "webui"
        },
        "5050": {
            "label": "pgAdmin"
        },
        "5432": {
            "label": "Postgres"
        }
    },
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.python",
                "ms-edgedevtools.vscode-edge-devtools",
                "ms-vscode-remote.remote-containers",
                "ms-azuretools.vscode-docker",
                "ms-vscode.live-server",
                "github.copilot-chat",
                "ritwickdey.liveserver",
                "pranaygp.vscode-css-peek",
                "google.gemini-cli-vscode-ide-companion",
                "googlecloudtools.cloudcode",
                "sst-dev.opencode"
            ],
            "settings": {
                "python.defaultInterpreterPath": "${containerWorkspaceFolder}/.venv/bin/python",
                "python.terminal.activateEnvironment": true,
                "terminal.integrated.env.linux": {
                    "VIRTUAL_ENV": "${containerWorkspaceFolder}/.venv",
                    "PATH": "${containerWorkspaceFolder}/.venv/bin:${env:PATH}"
                },
                "terminal.integrated.profiles.linux": {
                    "venv-bash": {
                        "path": "/bin/bash",
                        "args": ["-lc", "source ${containerWorkspaceFolder}/.venv/bin/activate; exec bash -l"]
                    }
                },
                "terminal.integrated.defaultProfile.linux": "venv-bash"
            }
        }
    }
}