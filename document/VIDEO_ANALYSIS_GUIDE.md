# 📹 影片分析功能使用指南

## 功能概述

XIAOICE 現在支援影片上傳和 YouTube 連結分析！AI 會自動提取影片關鍵幀，並一邊播放一邊分析影片中的人物動作、場景變化等內容。

---

## 🎯 主要功能

### 1. **影片上傳**
- 支援格式：MP4, AVI, MOV, MKV, WebM, FLV, WMV
- 最大檔案大小：500MB
- 拖放上傳或點擊上傳

### 2. **YouTube 影片分析**
- 貼上 YouTube 連結即可自動下載並分析
- 支援各種 YouTube URL 格式：
  - `https://www.youtube.com/watch?v=...`
  - `https://youtu.be/...`
  - `https://youtube.com/embed/...`

### 3. **AI 即時分析**
- 自動提取關鍵幀（預設每 5 秒一幀，最多 20 幀）
- AI 流式分析影片內容
- 描述人物動作、場景變化、重要細節

---

## 📖 使用步驟

### 方法一：上傳本地影片

1. **打開影片分析功能**
   - 點擊聊天框下方的影片按鈕 📹

2. **上傳影片**
   - 方式 A：拖放影片到上傳區域
   - 方式 B：點擊上傳區域選擇影片文件

3. **等待處理**
   - 系統會自動上傳並提取關鍵幀（約 10-30 秒）

4. **查看分析**
   - 影片會顯示在聊天框中
   - AI 開始流式分析，即時顯示分析結果

### 方法二：分析 YouTube 影片

1. **打開影片分析功能**
   - 點擊聊天框下方的影片按鈕 📹

2. **貼上 YouTube 連結**
   - 在「YouTube 連結」輸入框中貼上影片 URL
   - 例如：`https://www.youtube.com/watch?v=dQw4w9WgXcQ`

3. **點擊載入影片**
   - 點擊紅色的「載入影片」按鈕
   - 或直接按 Enter 鍵

4. **等待下載和分析**
   - 系統會下載 YouTube 影片（可能需要 1-3 分鐘）
   - 自動提取關鍵幀並開始分析

5. **查看結果**
   - 影片播放器會顯示在聊天框中
   - AI 即時分析影片內容

---

## 🔧 技術細節

### 關鍵幀提取
- **間隔時間**：每 5 秒提取一幀
- **最大數量**：20 幀（可在 `config.py` 調整）
- **用途**：減少 AI 分析成本，同時保留完整資訊

### AI 分析內容
1. **人物動作**：識別影片中人物的行為和動作
2. **場景描述**：分析環境、背景、氛圍
3. **時序變化**：按時間順序描述影片進程
4. **重要細節**：捕捉關鍵資訊和亮點

### 支援的影片格式
| 格式 | 副檔名 | 說明 |
|------|--------|------|
| MP4 | `.mp4` | 最推薦，相容性最好 |
| AVI | `.avi` | 常見格式 |
| MOV | `.mov` | Apple QuickTime |
| MKV | `.mkv` | 高品質容器 |
| WebM | `.webm` | 網頁影片 |
| FLV | `.flv` | Flash 影片 |
| WMV | `.wmv` | Windows Media |

---

## 💡 使用建議

### ✅ 最佳實踐

1. **影片長度**
   - 建議：1-10 分鐘的影片效果最好
   - 太長的影片會提取更多關鍵幀，分析時間較長

2. **影片品質**
   - 清晰的影片能獲得更準確的分析
   - 建議解析度：720p 或以上

3. **內容類型**
   - 適合：教學影片、運動影片、活動記錄
   - 適合：新聞片段、紀錄片
   - 不太適合：純音樂影片（沒有視覺變化）

### ⚠️ 注意事項

1. **檔案大小限制**
   - 最大 500MB
   - 太大的文件可能上傳失敗

2. **YouTube 下載**
   - 部分受版權保護的影片可能無法下載
   - 下載速度取決於網路狀況

3. **處理時間**
   - 本地上傳：10-30 秒
   - YouTube 下載：1-5 分鐘（視影片大小）
   - AI 分析：30 秒-2 分鐘

---

## 🛠️ 開發者資訊

### API 端點

#### 1. `/video/analyze` (POST)
分析影片並提取關鍵幀

**請求參數：**
```json
{
  "video": "影片文件（multipart/form-data）",
  // 或
  "youtube_url": "YouTube 影片連結"
}
```

**回應：**
```json
{
  "success": true,
  "video_info": {
    "title": "影片標題",
    "duration": 120.5,
    "fps": 30,
    "width": 1920,
    "height": 1080
  },
  "video_url": "/static/upload/video_xxx.mp4",
  "frames": [
    {
      "timestamp": 0.0,
      "frame_number": 0,
      "data": "base64_encoded_image",
      "mime_type": "image/jpeg"
    }
  ],
  "is_youtube": false
}
```

#### 2. `/video/stream-analysis` (POST)
流式分析影片內容

**請求參數：**
```json
{
  "frames": [/* 關鍵幀數組 */],
  "video_info": {/* 影片資訊 */},
  "prompt": "請描述影片內容"
}
```

**回應：** Server-Sent Events (SSE) 流式數據

---

## 📝 配置選項

在 `app/config.py` 中可調整：

```python
# 影片處理設定
VIDEO_FRAME_INTERVAL = 5  # 每 N 秒提取一幀
VIDEO_MAX_FRAMES = 20     # 最多提取幀數
MAX_CONTENT_LENGTH = 500 * 1024 * 1024  # 500MB

# 允許的影片格式
ALLOWED_VIDEO_EXTENSIONS = {'mp4', 'avi', 'mov', 'mkv', 'webm', 'flv', 'wmv'}
```

---

## 🐛 常見問題

### Q: YouTube 影片下載失敗？
**A:** 可能原因：
- 影片受版權保護
- 網路連接問題
- URL 格式不正確
- 影片已被刪除或設為私人

### Q: 上傳的影片無法播放？
**A:** 檢查：
- 影片格式是否支援
- 檔案是否損壞
- 瀏覽器是否支援該格式（建議使用 MP4）

### Q: AI 分析不準確？
**A:** 可能原因：
- 影片畫質太低
- 場景變化太快
- 光線太暗或模糊
- 建議使用清晰、穩定的影片

### Q: 處理時間太長？
**A:** 優化方法：
- 減少 `VIDEO_MAX_FRAMES` 數量
- 增加 `VIDEO_FRAME_INTERVAL` 間隔
- 使用較短的影片
- 壓縮影片檔案大小

---

## 🚀 未來功能計劃

- [ ] 支援即時影片串流分析
- [ ] 音訊轉錄和字幕生成
- [ ] 影片摘要和重點時間戳
- [ ] 多語言字幕支援
- [ ] 影片物件識別和追蹤
- [ ] 情緒和情感分析
- [ ] 批次影片處理

---

## 📞 支援

如有問題或建議，請：
1. 查看 Flask 日誌：`tail -f flask.log`
2. 檢查瀏覽器控制台錯誤
3. 提交 Issue 到專案倉庫

---

**享受智能影片分析的樂趣！** 🎬✨
